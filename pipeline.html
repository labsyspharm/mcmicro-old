<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 End-to-end pipeline execution | Image Processing Pipeline</title>
  <meta name="description" content="1 End-to-end pipeline execution | Image Processing Pipeline" />
  <meta name="generator" content="bookdown 0.15 and GitBook 2.6.7" />

  <meta property="og:title" content="1 End-to-end pipeline execution | Image Processing Pipeline" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="labsyspharm/mcmicro" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 End-to-end pipeline execution | Image Processing Pipeline" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="howto.html"/>
<link rel="next" href="stitch.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="extra-styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">LSP Image Processing Pipeline</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Quick Start</a></li>
<li class="chapter" data-level="" data-path="individual-module-documentation.html"><a href="individual-module-documentation.html"><i class="fa fa-check"></i>Individual module documentation</a></li>
<li class="chapter" data-level="" data-path="howto.html"><a href="howto.html"><i class="fa fa-check"></i>How To Contribute</a><ul>
<li><a href="howto.html#forksync">Synchronizing your fork with <code>labsyspharm</code></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="pipeline.html"><a href="pipeline.html"><i class="fa fa-check"></i><b>1</b> End-to-end pipeline execution</a><ul>
<li class="chapter" data-level="1.1" data-path="pipeline.html"><a href="pipeline.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a></li>
<li class="chapter" data-level="1.2" data-path="pipeline.html"><a href="pipeline.html#usage"><i class="fa fa-check"></i><b>1.2</b> Usage</a><ul>
<li class="chapter" data-level="1.2.1" data-path="pipeline.html"><a href="pipeline.html#data-transfer"><i class="fa fa-check"></i><b>1.2.1</b> Data transfer</a></li>
<li class="chapter" data-level="1.2.2" data-path="pipeline.html"><a href="pipeline.html#go-to-the-working-directory"><i class="fa fa-check"></i><b>1.2.2</b> Go to the working directory</a></li>
<li class="chapter" data-level="1.2.3" data-path="pipeline.html"><a href="pipeline.html#generate-the-pipeline-execution-script"><i class="fa fa-check"></i><b>1.2.3</b> Generate the pipeline execution script</a></li>
<li class="chapter" data-level="1.2.4" data-path="pipeline.html"><a href="pipeline.html#launch-the-pipeline"><i class="fa fa-check"></i><b>1.2.4</b> Launch the pipeline</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="pipeline.html"><a href="pipeline.html#worked-example-using-a-sample-dataset"><i class="fa fa-check"></i><b>1.3</b> Worked example using a sample dataset</a></li>
<li class="chapter" data-level="1.4" data-path="pipeline.html"><a href="pipeline.html#results"><i class="fa fa-check"></i><b>1.4</b> Results</a></li>
<li class="chapter" data-level="1.5" data-path="pipeline.html"><a href="pipeline.html#visualize-images-on-omero"><i class="fa fa-check"></i><b>1.5</b> Visualize Images on Omero</a></li>
<li class="chapter" data-level="1.6" data-path="pipeline.html"><a href="pipeline.html#tips-and-tricks"><i class="fa fa-check"></i><b>1.6</b> Tips and Tricks</a><ul>
<li class="chapter" data-level="1.6.1" data-path="pipeline.html"><a href="pipeline.html#processing-your-own-data"><i class="fa fa-check"></i><b>1.6.1</b> Processing your own data</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="pipeline.html"><a href="pipeline.html#frequently-asked-questions-faq"><i class="fa fa-check"></i><b>1.7</b> Frequently Asked Questions (FAQ)</a><ul>
<li class="chapter" data-level="1.7.1" data-path="pipeline.html"><a href="pipeline.html#help-my-o2-environment-changed"><i class="fa fa-check"></i><b>1.7.1</b> Help my O2 environment changed!</a></li>
<li class="chapter" data-level="1.7.2" data-path="pipeline.html"><a href="pipeline.html#how-to-setup-o2-ssh-key"><i class="fa fa-check"></i><b>1.7.2</b> How To Setup O2 SSH Key</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="pipeline.html"><a href="pipeline.html#instructions-for-pipeline-module-developers"><i class="fa fa-check"></i><b>1.8</b> Instructions for pipeline module developers</a><ul>
<li class="chapter" data-level="1.8.1" data-path="pipeline.html"><a href="pipeline.html#install-run"><i class="fa fa-check"></i><b>1.8.1</b> Install &amp; Run</a></li>
<li class="chapter" data-level="1.8.2" data-path="pipeline.html"><a href="pipeline.html#building-the-conda-environments"><i class="fa fa-check"></i><b>1.8.2</b> Building the Conda Environments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="stitch.html"><a href="stitch.html"><i class="fa fa-check"></i><b>2</b> Image Stitching and Registration</a><ul>
<li class="chapter" data-level="2.1" data-path="stitch.html"><a href="stitch.html#input"><i class="fa fa-check"></i><b>2.1</b> Input</a></li>
<li class="chapter" data-level="2.2" data-path="stitch.html"><a href="stitch.html#output"><i class="fa fa-check"></i><b>2.2</b> Output</a></li>
<li class="chapter" data-level="2.3" data-path="stitch.html"><a href="stitch.html#installation-1"><i class="fa fa-check"></i><b>2.3</b> Installation</a></li>
<li class="chapter" data-level="2.4" data-path="stitch.html"><a href="stitch.html#usage-1"><i class="fa fa-check"></i><b>2.4</b> Usage</a><ul>
<li class="chapter" data-level="2.4.1" data-path="stitch.html"><a href="stitch.html#docker-container"><i class="fa fa-check"></i><b>2.4.1</b> Docker container</a></li>
<li class="chapter" data-level="2.4.2" data-path="stitch.html"><a href="stitch.html#instructions-python"><i class="fa fa-check"></i><b>2.4.2</b> Native Python</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="stitch.html"><a href="stitch.html#example"><i class="fa fa-check"></i><b>2.5</b> Example</a></li>
<li class="chapter" data-level="2.6" data-path="stitch.html"><a href="stitch.html#more-details"><i class="fa fa-check"></i><b>2.6</b> More details</a></li>
<li class="chapter" data-level="2.7" data-path="stitch.html"><a href="stitch.html#references"><i class="fa fa-check"></i><b>2.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="segment.html"><a href="segment.html"><i class="fa fa-check"></i><b>3</b> Image Segmentation</a><ul>
<li class="chapter" data-level="3.1" data-path="segment.html"><a href="segment.html#preprocess"><i class="fa fa-check"></i><b>3.1</b> Image Preprocessing</a></li>
<li class="chapter" data-level="3.2" data-path="segment.html"><a href="segment.html#binarize"><i class="fa fa-check"></i><b>3.2</b> Probability map binarization</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>4</b> Extract spatial single cell features</a></li>
<li class="chapter" data-level="5" data-path="celltype.html"><a href="celltype.html"><i class="fa fa-check"></i><b>5</b> Assignment of cell type/state identity</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Image Processing Pipeline</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pipeline" class="section level1">
<h1><span class="header-section-number">1</span> End-to-end pipeline execution</h1>
<p>Here we will walk you through running the default end-to-end processing pipeline
comprising <a href="stitch.html#stitch">stitching and registration</a>, <a href="segment.html#segment">segmentation</a>, and
<a href="features.html#features">single-cell feature extration</a>.</p>
<div id="installation" class="section level2">
<h2><span class="header-section-number">1.1</span> Installation</h2>
<p>Run the following command to install the pipeline execution tools:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="fu">bash</span> /n/groups/lsp/cycif/mcmicro/O2_install.sh</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="bu">source</span> ~/.bash_profile</a></code></pre></div>
<p>Run this command to check for success:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="fu">which</span> cycif_pipeline_activate.sh</a></code></pre></div>
<ul>
<li>If you see <code>/n/groups/lsp/cycif/mcmicro/bin/cycif_pipeline_activate.sh</code>, the
installation succeeded.</li>
<li>If you see no cycif_pipeline_activate.sh in …` then the installation
failed.</li>
<li>If failed, contact someone from computational forum</li>
</ul>
</div>
<div id="usage" class="section level2">
<h2><span class="header-section-number">1.2</span> Usage</h2>
<p>The commands below use the username <code>abc123</code>, so in the typed commands you must
substitute your own username (or the username of whomever you’re working on
behalf of).</p>
<div id="data-transfer" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Data transfer</h3>
<p>First you will need to setup an ssh Key so O2 can connect to the transfer server in order to transfer your data</p>
<p><em>See Instructions in FAQ</em></p>
<p>Next you will need to transfer your data to the scratch space (temporary high data volume storage):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ex">sbatch</span> transfer.sbatch FROM /n/scratch2/abc123/PROJECT</a></code></pre></div>
<p>Replace <code>FROM</code> with the path to your data, and <code>PROJECT</code> with a short name for
this project or experiment. We will refer to <code>/n/scratch2/abc123/PROJECT</code> as the
“working directory”.</p>
<p><em>See Folder Setup in Folder Organization Example</em></p>
</div>
<div id="go-to-the-working-directory" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Go to the working directory</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="bu">cd</span> /n/scratch2/abc123/PROJECT</a></code></pre></div>
</div>
<div id="generate-the-pipeline-execution-script" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Generate the pipeline execution script</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="ex">cycif_pipeline_activate.sh</span> /n/scratch2/abc123/PROJECT</a></code></pre></div>
</div>
<div id="launch-the-pipeline" class="section level3">
<h3><span class="header-section-number">1.2.4</span> Launch the pipeline</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="fu">bash</span> Run_CyCif_pipeline.sh</a></code></pre></div>
</div>
</div>
<div id="worked-example-using-a-sample-dataset" class="section level2">
<h2><span class="header-section-number">1.3</span> Worked example using a sample dataset</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ex">sbatch</span> --wait transfer.sbatch /n/groups/lsp/cycif/mcmicro/example_data/ /n/scratch2/abc123/example_data</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="bu">cd</span> /n/scratch2/abc123/example_data</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="ex">cycif_pipeline_activate.sh</span> /n/scratch2/abc123/example_data</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="fu">bash</span> Run_CyCif_pipeline.sh</a></code></pre></div>
<p>Note that we have added the <code>--wait</code> option to the <code>sbatch</code> command which will
pause until the data has finished transferring before continuing with the
remaining steps. This is only practical if the dataset is small (less than about
50 GB). If your data is larger, see the Tips and Tricks section below.</p>
</div>
<div id="results" class="section level2">
<h2><span class="header-section-number">1.4</span> Results</h2>
<p>Upon completion of the pipeline, the following folders will appear within your
project directory containing the processed information from each part of the
pipeline. The folders are:</p>
<ul>
<li><code>cell_states</code>: Placeholder for future analysis</li>
<li><code>clustering</code>: Placeholder for future analysis</li>
<li><code>dearray</code>: Contains masks</li>
<li><code>feature_extraction</code>: The counts matrix of marker expression at a single cell
level for all images (Output of HistoCAT software)</li>
<li><code>illumination_profiles</code>: Preprocessing files required for stitching the
acquired raw tiles into a single image (Ashlar)</li>
<li><code>prob_maps</code>: Probability maps predicted by the UMAP deep learning algorithm
for identifying nucleus, cell borders and background</li>
<li><code>raw_files</code>: Your original folder containing the raw images</li>
<li><code>registration</code>: Image that has been stitched and aligned over multiple cycles
(needs to be uploaded to Omero for viewing or can be viewed using Image J)</li>
<li><code>segmentation</code>: Provides the location for the nuclei and a cell within an
image</li>
</ul>
</div>
<div id="visualize-images-on-omero" class="section level2">
<h2><span class="header-section-number">1.5</span> Visualize Images on Omero</h2>
<ol style="list-style-type: decimal">
<li>Transfer data to ImStor</li>
<li>Import data to Omero</li>
</ol>
</div>
<div id="tips-and-tricks" class="section level2">
<h2><span class="header-section-number">1.6</span> Tips and Tricks</h2>
<div id="processing-your-own-data" class="section level3">
<h3><span class="header-section-number">1.6.1</span> Processing your own data</h3>
<div id="folder-organization-example" class="section level4">
<h4><span class="header-section-number">1.6.1.1</span> Folder Organization Example</h4>
<p>Project folder must be at a location findable by O2.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">bionerd@MTS-LSP-L06275</span>:~/Dana_Farber/CyCif/git/CyCif_O2_Manager/example_data$ pwd</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ex">/home/bionerd/Dana_Farber/CyCif/git/CyCif_O2_Manager/example_data</span></a></code></pre></div>
<p>Within your data folder there are separate folders for each imaged slide.
Can be whole tissue slide or TMA (eventually).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">bionerd@MTS-LSP-L06275</span>:~/Dana_Farber/CyCif/git/CyCif_O2_Manager/example_data$ ll</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ex">drwxrwxrwx</span> 1 bionerd bionerd 4096 Aug  9 08:03 image_1/</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="ex">drwxrwxrwx</span> 1 bionerd bionerd 4096 Aug  9 08:04 image_2/</a></code></pre></div>
<p>Each folder should contain a subfolder: ‘raw_files’ with
where for each CyCIF cycle there should the raw images from the microscope
for example from Rare Cycte: ‘.rcpnl’ and ‘.metadata’</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">bionerd@MTS-LSP-L06275</span>:~/Dana_Farber/CyCif/git/CyCif_O2_Manager/example_data$ ll image_1/</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ex">total</span> 0</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="ex">drwxrwxrwx</span> 1 bionerd bionerd 4096 Aug  9 10:44 ./</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="ex">drwxrwxrwx</span> 1 bionerd bionerd 4096 Aug  7 12:19 ../</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="ex">drwxrwxrwx</span> 1 bionerd bionerd 4096 Aug  9 08:04 raw_files/</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">[<span class="ex">ntj8@login01</span> image_1]$ cd raw_files/</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">[<span class="ex">ntj8@login01</span> raw_files]$ ll</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="ex">total</span> 3326644</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="ex">-rwxrwx---</span> 1 ntj8 ntj8      11516 Jul  9 17:30 Scan_20190612_164155_01x4x00154.metadata</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="ex">-rwxrwx---</span> 1 ntj8 ntj8 1703221248 Jul  9 17:31 Scan_20190612_164155_01x4x00154.rcpnl</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="ex">-rwxrwx---</span> 1 ntj8 ntj8      11524 Jul  9 17:31 Scan_20190613_125815_01x4x00154.metadata</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="ex">-rwxrwx---</span> 1 ntj8 ntj8 1703221248 Jul  9 17:32 Scan_20190613_125815_01x4x00154.rcpnl</a></code></pre></div>
<p>After the CyCIF Pipeline is run there will be additional folders created for
each slide (explained in <a href="pipeline.html#results">Results</a>).</p>
</div>
<div id="requirements" class="section level4">
<h4><span class="header-section-number">1.6.1.2</span> Requirements</h4>
<ul>
<li>Can be run either locally or on O2.</li>
<li>For O2, user must have an O2 account and be a member of the <code>ImStor_sorger</code> groups. Run <code>groups</code> on O2 to check.
<ul>
<li>Request O2 account and group access at <a href="https://rc.hms.harvard.edu/" class="uri">https://rc.hms.harvard.edu/</a>.</li>
</ul></li>
<li>For the moment, you are responsible for transferring the data to the scratch space</li>
<li>Data follows Folder Organization (shown above).</li>
<li>File ‘markers.csv’ containing one marker per row, in the order imaged. Example:</li>
</ul>
<pre><code>DNA1
AF488
AF555
AF647
DNA2
mLY6C
mCD8A
mCD68</code></pre>
<ul>
<li>File ‘data.yaml’ listing what parameters to use for pipeline execution (If you are unsure, just use the current ones) Example:</li>
</ul>
<pre><code>--- 
Run:
  Name: &#39;CyCif Example&#39;
  TMA: False
  cf25: False
  file_extension: .rcpnl
QC:
Illumination:
  lambda_flat: 0.1
  lambda_dark: 0.01
  estimate_flat_field_only: False
  max_number_of_fields_used: None
Stitcher:
  -m: 30 
  --filter-sigma: 0
Probability_Mapper:
  dapi_channel: 0
  hs_scaling: 1
  vs_scaling: 1
Segmenter:
  HPC: true
  fileNum: 1
  TissueMaskChan: [2] #must include brackets
  logSigma: [3 30] #must include brackets
  mask: tissue
  segmentCytoplasm: ignoreCytoplasm
Feature_Extractor:
  mask : cellMask.tif
  expansionpixels : 5
  neighborhood : no</code></pre>
</div>
</div>
</div>
<div id="frequently-asked-questions-faq" class="section level2">
<h2><span class="header-section-number">1.7</span> Frequently Asked Questions (FAQ)</h2>
<div id="help-my-o2-environment-changed" class="section level3">
<h3><span class="header-section-number">1.7.1</span> Help my O2 environment changed!</h3>
<p>O2 loads in <code>.bash_profile</code> then <code>.bashrc</code> by default unless <code>.bash_profile</code>
does not exist. If your O2 environment has changed, it is likely that the
installation instructions created <code>.bash_profile</code>. Solution is to replace the
installation instructions from <code>.bash_profile</code> to <code>.bashrc</code></p>
</div>
<div id="how-to-setup-o2-ssh-key" class="section level3">
<h3><span class="header-section-number">1.7.2</span> How To Setup O2 SSH Key</h3>
<p>The following instructions take you through setting up a SSH Key on O2. (<a href="https://wiki.rc.hms.harvard.edu/display/O2/How+to+Generate+SSH+Keys">Official instructions for generating SSH key</a>)</p>
<p>The senario behind this is that in CyCIF pipeline, it is designed to first submit a job to transfer files from /n/files, get the job ID, and the following steps in the pipeline are dependent on the transfer job.</p>
<p>And the SSH Key allows you to transfer files from /n/files using the transfer server with <code>ssh rsync</code>, without being prompted for password. So that you can put <code>ssh rsync</code> from n/files to /n/scratch2 into an sbatch script. And the job could hang until the transfer is complete, then it will run the rest of the script.</p>
<div id="note-replace-your_ecommons-with-your-ecommons-while-you-type-in-the-commands." class="section level5">
<h5><span class="header-section-number">1.7.2.0.1</span> Note: Replace your_ecommons with your ecommons while you type in the commands.</h5>
<hr />
</div>
<div id="generate-ssh-key" class="section level4">
<h4><span class="header-section-number">1.7.2.1</span> Generate SSH Key</h4>
<p><em>On O2 login node</em></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" data-line-number="1">$ <span class="fu">ssh-keygen</span> -t rsa</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="ex">Generating</span> public/private rsa key pair.</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="ex">Enter</span> file in which to save the key (/home/your_ecommons/.ssh/id_rsa)<span class="bu">:</span></a></code></pre></div>
<p>Hit Enter ⏎</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="ex">Enter</span> passphrase (empty for no passphrase)<span class="bu">:</span></a></code></pre></div>
<p>Hit Enter ⏎</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="ex">Enter</span> same passphrase again:</a></code></pre></div>
<p>Hit Enter ⏎</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="ex">Your</span> identification has been saved in /home/your_ecommons/.ssh/id_rsa.</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ex">Your</span> public key has been saved in /home/your_ecommons/.ssh/id_rsa.pub.</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="ex">The</span> key fingerprint is:</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="ex">a5</span>:b5:38:73:b7:3c:a6:8a:1d:a8:bd:87:4e:be:33:21 your_ecommons@login01</a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="ex">The</span> key<span class="st">&#39;s randomart image is:</span></a></code></pre></div>
<p>The following command copies the public key to your authorized_keys file:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" data-line-number="1">$ <span class="fu">cat</span> ~/.ssh/id_rsa.pub <span class="op">&gt;&gt;</span> ~/.ssh/authorized_keys</a></code></pre></div>
</div>
<div id="change-file-and-directory-permissions" class="section level4">
<h4><span class="header-section-number">1.7.2.2</span> Change file and directory permissions</h4>
<p><em>On O2 login node</em></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" data-line-number="1">$ <span class="fu">chmod</span> 0600 ~/.ssh/authorized_keys</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">$ <span class="fu">chmod</span> 0700 ~/.ssh</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">$ <span class="fu">chmod</span> 0711 /home/<span class="va">$USER</span></a></code></pre></div>
</div>
<div id="testing" class="section level4">
<h4><span class="header-section-number">1.7.2.3</span> Testing</h4>
<p><em>On O2 login node</em></p>
<pre><code>$ srun -p interactive --pty -t 1:00:00 -n 2 bash
srun: job 50830472 queued and waiting for resources
srun: job 50830472 has been allocated resources
$ rsync -Pav transfer:/n/files/ImStor/sorger/data/RareCyte/yc296/YC-20180711-bleached-for-15-min/ /n/scratch2/yc296/transfer_test/
created directory /n/scratch2/your_ecommons/transfer_test
./
CSS08_A-bleach-light-new-S100-MCM6-p57-LSP2-Scan_20180711_144802_01x4x00090.rcpnl
   995391488 100%   95.99MB/s    0:00:09 (xfer#1, to-check=5/7)
CSS08_B-bleach-light-new-S100-MCM6-p57-LSP2-Scan_20180711_144203_01x4x00110.rcpnl
  1216587776 100%   90.51MB/s    0:00:12 (xfer#2, to-check=4/7)
CSS08_C-bleach-light-old-S100-MCM6-p57-LSP1-Scan_20180711_143205_01x4x00100.rcpnl
  1105989632 100%   90.95MB/s    0:00:11 (xfer#3, to-check=3/7)
Scan_20180711_143205_01x4x00100.metadata
        8344 100%   13.34kB/s    0:00:00 (xfer#4, to-check=2/7)
Scan_20180711_144203_01x4x00110.metadata
        9024 100%   14.35kB/s    0:00:00 (xfer#5, to-check=1/7)
Scan_20180711_144802_01x4x00090.metadata
        7636 100%   12.11kB/s    0:00:00 (xfer#6, to-check=0/7)

sent 128 bytes  received 3318399628 bytes  99056709.13 bytes/sec
total size is 3317993900  speedup is 1.00</code></pre>
</div>
</div>
</div>
<div id="instructions-for-pipeline-module-developers" class="section level2">
<h2><span class="header-section-number">1.8</span> Instructions for pipeline module developers</h2>
<p>Updated your code?</p>
<pre><code>#need conda environment for git lfs (Instructions for O2)
module load conda2/4.2.13
#activate the cycif pipeline environment (path
source activate  [path to mcmicro]/environments/cycif_pipeline
#clones all developer code based on last update of mcmicro
git submodule update []</code></pre>
<p>Wish to add your method to pipeline? Contact Nathan.</p>
<div id="install-run" class="section level3">
<h3><span class="header-section-number">1.8.1</span> Install &amp; Run</h3>
<p>Assumptions:
Matlab Installed
Linux Slurm HPC Environment
Git Installed</p>
<pre><code>git clone https://github.com/labsyspharm/mcmicro.git</code></pre>
<p>Install conda environments</p>
<pre><code>[path to mcmmicro]/bin/install_environments.sh
</code></pre>
<p>Downloads exemplar data to current directory</p>
<pre><code>[path to mcmmicro]/bin/mcmicro-download-exemplar-001.sh
[path to mcmmicro]/bin/mcmicro-download-exemplar-002.sh</code></pre>
<p>Install module code: uses git submodules</p>
<pre><code>#need conda environment for git lfs (Instructions for O2)
module load conda2/4.2.13
#activate the cycif pipeline environment (path
source activate  [path to mcmicro]/environments/cycif_pipeline
#clones all developer code based on last update of mcmicro 
git submodule update --init --recursive
#update to latest version (can update to latest version of developer code, but may have been tested)
git submodule update --recursive 
#alt way to update to latest git repo version if submodule update doesn&#39;t update
git pull --recurse-submodules</code></pre>
</div>
<div id="building-the-conda-environments" class="section level3">
<h3><span class="header-section-number">1.8.2</span> Building the Conda Environments</h3>
<p>Instructions for building the ashlar and ashlar_c25 environments are present in mcmicro/bin/ashlar_cf25_update.sh and mcmicro/bin/ashlar_update.sh</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="howto.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stitch.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"github": true
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
